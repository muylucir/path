module.exports=[66680,(e,r,t)=>{r.exports=e.x("node:crypto",()=>require("node:crypto"))},60526,(e,r,t)=>{r.exports=e.x("node:os",()=>require("node:os"))},50227,(e,r,t)=>{r.exports=e.x("node:path",()=>require("node:path"))},88625,e=>{"use strict";e.s([],9584),e.i(9584);var r=e.i(49871),t=e.i(98854),i=e.i(7401),n=e.i(80849),s=e.i(34028);let o=e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),a=async(t,a,c,d,g={},f)=>{c.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let u=a[t],{source_profile:p,region:_}=u;if(!c.roleAssumer){let{getDefaultRoleAssumer:r}=await e.A(98730);c.roleAssumer=r({...c.clientConfig,credentialProviderLogger:c.logger,parentClientConfig:{...d,...c?.parentClientConfig,region:_??c?.parentClientConfig?.region??d?.region}},c.clientPlugins)}if(p&&p in g)throw new i.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${(0,r.getProfileName)(c)}. Profiles visited: `+Object.keys(g).join(", "),{logger:c.logger});c.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${p?`source_profile=[${p}]`:`profile=[${t}]`}`);let h=p?f(p,a,c,d,{...g,[p]:!0},l(a[p]??{})):(await ((r,t,n)=>{let a={EcsContainer:async r=>{let{fromHttp:t}=await e.A(10247),{fromContainerMetadata:i}=await e.A(52973);return n?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>(0,s.chain)(t(r??{}),i(r))().then(o)},Ec2InstanceMetadata:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:t}=await e.A(52973);return async()=>t(r)().then(o)},Environment:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:t}=await e.A(61521);return async()=>t(r)().then(o)}};if(r in a)return a[r];throw new i.CredentialsProviderError(`Unsupported credential source in profile ${t}. Got ${r}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:n})})(u.credential_source,t,c.logger)(c))();if(l(u))return h.then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{let e={RoleArn:u.role_arn,RoleSessionName:u.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:u.external_id,DurationSeconds:parseInt(u.duration_seconds||"3600",10)},{mfa_serial:r}=u;if(r){if(!c.mfaCodeProvider)throw new i.CredentialsProviderError(`Profile ${t} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:c.logger,tryNextLink:!1});e.SerialNumber=r,e.TokenCode=await c.mfaCodeProvider(r)}let s=await h;return c.roleAssumer(s,e).then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},l=e=>!e.role_arn&&!!e.credential_source;var c=e.i(90409),d=e.i(46334),g=e.i(66680),f=e.i(2157),u=e.i(60526),p=e.i(50227);class _{profileData;init;callerClientConfig;static REFRESH_THRESHOLD=3e5;constructor(e,r,t){this.profileData=e,this.init=r,this.callerClientConfig=t}async loadCredentials(){let e=await this.loadToken();if(!e)throw new i.CredentialsProviderError(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});let r=e.accessToken,t=Date.now();return new Date(r.expiresAt).getTime()-t<=_.REFRESH_THRESHOLD?this.refresh(e):{accessKeyId:r.accessKeyId,secretAccessKey:r.secretAccessKey,sessionToken:r.sessionToken,accountId:r.accountId,expiration:new Date(r.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(r){let t,{SigninClient:n,CreateOAuth2TokenCommand:s}=await e.A(254),{logger:o,userAgentAppId:a}=this.callerClientConfig??{},l=(t=this.callerClientConfig?.requestHandler,t?.metadata?.handlerProtocol==="h2")?void 0:this.callerClientConfig?.requestHandler,c=new n({credentials:{accessKeyId:"",secretAccessKey:""},region:this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,requestHandler:l,logger:o,userAgentAppId:a,...this.init?.clientConfig});this.createDPoPInterceptor(c.middlewareStack);let d={tokenInput:{clientId:r.clientId,refreshToken:r.refreshToken,grantType:"refresh_token"}};try{let e=await c.send(new s(d)),{accessKeyId:t,secretAccessKey:n,sessionToken:o}=e.tokenOutput?.accessToken??{},{refreshToken:a,expiresIn:l}=e.tokenOutput??{};if(!t||!n||!o||!a)throw new i.CredentialsProviderError("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});let g=new Date(Date.now()+(l??900)*1e3),f={...r,accessToken:{...r.accessToken,accessKeyId:t,secretAccessKey:n,sessionToken:o,expiresAt:g.toISOString()},refreshToken:a};await this.saveToken(f);let u=f.accessToken;return{accessKeyId:u.accessKeyId,secretAccessKey:u.secretAccessKey,sessionToken:u.sessionToken,accountId:u.accountId,expiration:g}}catch(e){if("AccessDeniedException"===e.name){let r;switch(e.error){case"TOKEN_EXPIRED":r="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":r="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":r="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:r=`Failed to refresh token: ${String(e)}. Please re-authenticate using \`aws login\``}throw new i.CredentialsProviderError(r,{logger:this.logger,tryNextLink:!1})}throw new i.CredentialsProviderError(`Failed to refresh token: ${String(e)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){let e=this.getTokenFilePath();try{let r;try{r=await (0,d.readFile)(e,{ignoreCache:this.init?.ignoreCache})}catch{r=await f.promises.readFile(e,"utf8")}let t=JSON.parse(r),n=["accessToken","clientId","refreshToken","dpopKey"].filter(e=>!t[e]);if(t.accessToken?.accountId||n.push("accountId"),n.length>0)throw new i.CredentialsProviderError(`Token validation failed, missing fields: ${n.join(", ")}`,{logger:this.logger,tryNextLink:!1});return t}catch(r){throw new i.CredentialsProviderError(`Failed to load token from ${e}: ${String(r)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(e){let r=this.getTokenFilePath(),t=(0,p.dirname)(r);try{await f.promises.mkdir(t,{recursive:!0})}catch(e){}await f.promises.writeFile(r,JSON.stringify(e,null,2),"utf8")}getTokenFilePath(){let e=process.env.AWS_LOGIN_CACHE_DIRECTORY??(0,p.join)((0,u.homedir)(),".aws","login","cache"),r=Buffer.from(this.loginSession,"utf8"),t=(0,g.createHash)("sha256").update(r).digest("hex");return(0,p.join)(e,`${t}.json`)}derToRawSignature(e){let r=2;if(2!==e[2])throw Error("Invalid DER signature");r++;let t=e[r++],i=e.subarray(r,r+t);if(2!==e[r+=t])throw Error("Invalid DER signature");r++;let n=e[r++],s=e.subarray(r,r+n);i=0===i[0]?i.subarray(1):i,s=0===s[0]?s.subarray(1):s;let o=Buffer.concat([Buffer.alloc(32-i.length),i]),a=Buffer.concat([Buffer.alloc(32-s.length),s]);return Buffer.concat([o,a])}createDPoPInterceptor(e){e.add(e=>async r=>{if(c.HttpRequest.isInstance(r.request)){let e=r.request,t=`${e.protocol}//${e.hostname}${e.port?`:${e.port}`:""}${e.path}`,i=await this.generateDpop(e.method,t);e.headers={...e.headers,DPoP:i}}return e(r)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(e="POST",r){let t=await this.loadToken();try{let i=(0,g.createPrivateKey)({key:t.dpopKey,format:"pem",type:"sec1"}),n=(0,g.createPublicKey)(i).export({format:"der",type:"spki"}),s=-1;for(let e=0;e<n.length;e++)if(4===n[e]){s=e;break}let o=n.slice(s+1,s+33),a=n.slice(s+33,s+65),l={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:o.toString("base64url"),y:a.toString("base64url")}},c={jti:crypto.randomUUID(),htm:e,htu:r,iat:Math.floor(Date.now()/1e3)},d=Buffer.from(JSON.stringify(l)).toString("base64url"),f=Buffer.from(JSON.stringify(c)).toString("base64url"),u=`${d}.${f}`,p=(0,g.sign)("sha256",Buffer.from(u),i),_=this.derToRawSignature(p).toString("base64url");return`${u}.${_}`}catch(e){throw new i.CredentialsProviderError(`Failed to generate Dpop proof: ${e instanceof Error?e.message:String(e)}`,{logger:this.logger,tryNextLink:!1})}}}let h=async(e,s,o)=>{let a,l=await (a={...s,profile:e},async({callerClientConfig:e}={})=>{a?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");let s=await (0,t.parseKnownFiles)(a||{}),o=(0,r.getProfileName)({profile:a?.profile??e?.profile}),l=s[o];if(!l?.login_session)throw new i.CredentialsProviderError(`Profile ${o} does not contain login_session.`,{tryNextLink:!0,logger:a?.logger});let c=new _(l,a,e),d=await c.loadCredentials();return(0,n.setCredentialFeature)(d,"CREDENTIALS_LOGIN","AD")})({callerClientConfig:o});return(0,n.setCredentialFeature)(l,"CREDENTIALS_PROFILE_LOGIN","AC")},y=async(r,t)=>e.A(54340).then(({fromProcess:e})=>e({...r,profile:t})().then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_PROCESS","v"))),w=async(r,t,i={},s)=>{let{fromSSO:o}=await e.A(14514);return o({profile:r,logger:i.logger,parentClientConfig:i.parentClientConfig,clientConfig:i.clientConfig})({callerClientConfig:s}).then(e=>t.sso_session?(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO","r"):(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},C=e=>!!e&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,E=async(e,r)=>{r?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let t={accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}};return(0,n.setCredentialFeature)(t,"CREDENTIALS_PROFILE","n")},k=async(r,t,i)=>e.A(31643).then(({fromTokenFile:e})=>e({webIdentityTokenFile:r.web_identity_token_file,roleArn:r.role_arn,roleSessionName:r.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})({callerClientConfig:i}).then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),I=async(e,r,t,n,s={},o=!1)=>{let l=r[e];if(Object.keys(s).length>0&&C(l))return E(l,t);if(o||((e,{profile:r="default",logger:t}={})=>!!e&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(((e,{profile:r,logger:t})=>{let i="string"==typeof e.source_profile&&void 0===e.credential_source;return i&&t?.debug?.(`    ${r} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),i})(e,{profile:r,logger:t})||((e,{profile:r,logger:t})=>{let i="string"==typeof e.credential_source&&void 0===e.source_profile;return i&&t?.debug?.(`    ${r} isCredentialSourceProfile credential_source=${e.credential_source}`),i})(e,{profile:r,logger:t})))(l,{profile:e,logger:t.logger}))return a(e,r,t,n,s,I);if(C(l))return E(l,t);if(l&&"object"==typeof l&&"string"==typeof l.web_identity_token_file&&"string"==typeof l.role_arn&&["undefined","string"].indexOf(typeof l.role_session_name)>-1)return k(l,t,n);if(l&&"object"==typeof l&&"string"==typeof l.credential_process)return y(t,e);if(l&&("string"==typeof l.sso_start_url||"string"==typeof l.sso_account_id||"string"==typeof l.sso_session||"string"==typeof l.sso_region||"string"==typeof l.sso_role_name))return await w(e,l,t,n);if(l&&l.login_session)return h(e,t,n);throw new i.CredentialsProviderError(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:t.logger})},m=(e={})=>async({callerClientConfig:i}={})=>{e.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let n=await (0,t.parseKnownFiles)(e);return I((0,r.getProfileName)({profile:e.profile??i?.profile}),n,e,i)};e.s(["fromIni",0,m],5914),e.i(5914),e.s(["fromIni",0,m],88625)},61521,e=>{e.v(r=>Promise.all(["server/chunks/03239_@aws-sdk_credential-provider-env_dist-es_index_6cf4a60d.js"].map(r=>e.l(r))).then(()=>r(29281)))},98730,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__6bd37a6f._.js","server/chunks/03239_@aws-sdk_nested-clients_dist-es_submodules_sts_index_27ea9648.js"].map(r=>e.l(r))).then(()=>r(30433)))},254,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__e2eabf5f._.js","server/chunks/03239_@aws-sdk_nested-clients_dist-es_submodules_signin_index_b33d5c07.js"].map(r=>e.l(r))).then(()=>r(16123)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1f0b716e._.js.map