{"version":3,"sources":["../../../../../path/path-web/node_modules/%40smithy/shared-ini-file-loader/dist-es/getSSOTokenFromFile.js","../../../../../path/path-web/node_modules/%40smithy/shared-ini-file-loader/dist-es/getSSOTokenFilepath.js","../../../../../path/path-web/node_modules/%40smithy/shared-ini-file-loader/dist-es/externalDataInterceptor.js","../../../../../path/path-web/node_modules/%40aws-sdk/credential-provider-web-identity/dist-es/fromTokenFile.js","../../../../../path/path-web/node_modules/%40aws-sdk/credential-provider-web-identity/dist-es/fromWebToken.js"],"sourcesContent":["import { readFile } from \"fs/promises\";\nimport { getSSOTokenFilepath } from \"./getSSOTokenFilepath\";\nexport const tokenIntercept = {};\nexport const getSSOTokenFromFile = async (id) => {\n    if (tokenIntercept[id]) {\n        return tokenIntercept[id];\n    }\n    const ssoTokenFilepath = getSSOTokenFilepath(id);\n    const ssoTokenText = await readFile(ssoTokenFilepath, \"utf8\");\n    return JSON.parse(ssoTokenText);\n};\n","import { createHash } from \"crypto\";\nimport { join } from \"path\";\nimport { getHomeDir } from \"./getHomeDir\";\nexport const getSSOTokenFilepath = (id) => {\n    const hasher = createHash(\"sha1\");\n    const cacheName = hasher.update(id).digest(\"hex\");\n    return join(getHomeDir(), \".aws\", \"sso\", \"cache\", `${cacheName}.json`);\n};\n","import { tokenIntercept } from \"./getSSOTokenFromFile\";\nimport { fileIntercept } from \"./readFile\";\nexport const externalDataInterceptor = {\n    getFileRecord() {\n        return fileIntercept;\n    },\n    interceptFile(path, contents) {\n        fileIntercept[path] = Promise.resolve(contents);\n    },\n    getTokenRecord() {\n        return tokenIntercept;\n    },\n    interceptToken(id, contents) {\n        tokenIntercept[id] = contents;\n    },\n};\n","import { setCredentialFeature } from \"@aws-sdk/core/client\";\nimport { CredentialsProviderError } from \"@smithy/property-provider\";\nimport { externalDataInterceptor } from \"@smithy/shared-ini-file-loader\";\nimport { readFileSync } from \"fs\";\nimport { fromWebToken } from \"./fromWebToken\";\nconst ENV_TOKEN_FILE = \"AWS_WEB_IDENTITY_TOKEN_FILE\";\nconst ENV_ROLE_ARN = \"AWS_ROLE_ARN\";\nconst ENV_ROLE_SESSION_NAME = \"AWS_ROLE_SESSION_NAME\";\nexport const fromTokenFile = (init = {}) => async (awsIdentityProperties) => {\n    init.logger?.debug(\"@aws-sdk/credential-provider-web-identity - fromTokenFile\");\n    const webIdentityTokenFile = init?.webIdentityTokenFile ?? process.env[ENV_TOKEN_FILE];\n    const roleArn = init?.roleArn ?? process.env[ENV_ROLE_ARN];\n    const roleSessionName = init?.roleSessionName ?? process.env[ENV_ROLE_SESSION_NAME];\n    if (!webIdentityTokenFile || !roleArn) {\n        throw new CredentialsProviderError(\"Web identity configuration not specified\", {\n            logger: init.logger,\n        });\n    }\n    const credentials = await fromWebToken({\n        ...init,\n        webIdentityToken: externalDataInterceptor?.getTokenRecord?.()[webIdentityTokenFile] ??\n            readFileSync(webIdentityTokenFile, { encoding: \"ascii\" }),\n        roleArn,\n        roleSessionName,\n    })(awsIdentityProperties);\n    if (webIdentityTokenFile === process.env[ENV_TOKEN_FILE]) {\n        setCredentialFeature(credentials, \"CREDENTIALS_ENV_VARS_STS_WEB_ID_TOKEN\", \"h\");\n    }\n    return credentials;\n};\n","export const fromWebToken = (init) => async (awsIdentityProperties) => {\n    init.logger?.debug(\"@aws-sdk/credential-provider-web-identity - fromWebToken\");\n    const { roleArn, roleSessionName, webIdentityToken, providerId, policyArns, policy, durationSeconds } = init;\n    let { roleAssumerWithWebIdentity } = init;\n    if (!roleAssumerWithWebIdentity) {\n        const { getDefaultRoleAssumerWithWebIdentity } = await import(\"@aws-sdk/nested-clients/sts\");\n        roleAssumerWithWebIdentity = getDefaultRoleAssumerWithWebIdentity({\n            ...init.clientConfig,\n            credentialProviderLogger: init.logger,\n            parentClientConfig: {\n                ...awsIdentityProperties?.callerClientConfig,\n                ...init.parentClientConfig,\n            },\n        }, init.clientPlugins);\n    }\n    return roleAssumerWithWebIdentity({\n        RoleArn: roleArn,\n        RoleSessionName: roleSessionName ?? `aws-sdk-js-session-${Date.now()}`,\n        WebIdentityToken: webIdentityToken,\n        ProviderId: providerId,\n        PolicyArns: policyArns,\n        Policy: policy,\n        DurationSeconds: durationSeconds,\n    });\n};\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4]}