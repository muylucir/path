{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///home/ec2-user/project/path/path-web/lib/aws/bedrock.ts"],"sourcesContent":["import {\n  BedrockRuntimeClient,\n  InvokeModelCommand,\n  InvokeModelWithResponseStreamCommand,\n} from \"@aws-sdk/client-bedrock-runtime\";\n\nconst client = new BedrockRuntimeClient({\n  region: process.env.AWS_REGION || \"us-east-1\",\n});\n\nconst MODEL_ID = \"global.anthropic.claude-sonnet-4-5-20250929-v1:0\";\n\nexport interface BedrockMessage {\n  role: \"user\" | \"assistant\";\n  content: string;\n}\n\nexport async function invokeClaude(\n  prompt: string,\n  systemPrompt?: string\n): Promise<string> {\n  const messages = [{ role: \"user\", content: prompt }];\n\n  const body: any = {\n    anthropic_version: \"bedrock-2023-05-31\",\n    max_tokens: 16000,\n    messages,\n    temperature: 0.5,\n  };\n\n  if (systemPrompt) {\n    body.system = systemPrompt;\n  }\n\n  const command = new InvokeModelCommand({\n    modelId: MODEL_ID,\n    body: JSON.stringify(body),\n  });\n\n  const response = await client.send(command);\n  const result = JSON.parse(new TextDecoder().decode(response.body));\n  return result.content[0].text;\n}\n\nexport async function* invokeClaudeStream(\n  prompt: string,\n  systemPrompt?: string\n): AsyncGenerator<string> {\n  const messages = [{ role: \"user\", content: prompt }];\n\n  const body: any = {\n    anthropic_version: \"bedrock-2023-05-31\",\n    max_tokens: 16000,\n    messages,\n    temperature: 0.5,\n  };\n\n  if (systemPrompt) {\n    body.system = systemPrompt;\n  }\n\n  const command = new InvokeModelWithResponseStreamCommand({\n    modelId: MODEL_ID,\n    body: JSON.stringify(body),\n  });\n\n  const response = await client.send(command);\n\n  if (response.body) {\n    for await (const event of response.body) {\n      if (event.chunk?.bytes) {\n        const chunk = JSON.parse(new TextDecoder().decode(event.chunk.bytes));\n        if (chunk.type === \"content_block_delta\") {\n          if (chunk.delta?.text) {\n            yield chunk.delta.text;\n          }\n        }\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;;AAMA,MAAM,SAAS,IAAI,mQAAoB,CAAC;IACtC,QAAQ,QAAQ,GAAG,CAAC,UAAU,IAAI;AACpC;AAEA,MAAM,WAAW;AAOV,eAAe,aACpB,MAAc,EACd,YAAqB;IAErB,MAAM,WAAW;QAAC;YAAE,MAAM;YAAQ,SAAS;QAAO;KAAE;IAEpD,MAAM,OAAY;QAChB,mBAAmB;QACnB,YAAY;QACZ;QACA,aAAa;IACf;IAEA,IAAI,cAAc;QAChB,KAAK,MAAM,GAAG;IAChB;IAEA,MAAM,UAAU,IAAI,2QAAkB,CAAC;QACrC,SAAS;QACT,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC;IACnC,MAAM,SAAS,KAAK,KAAK,CAAC,IAAI,cAAc,MAAM,CAAC,SAAS,IAAI;IAChE,OAAO,OAAO,OAAO,CAAC,EAAE,CAAC,IAAI;AAC/B;AAEO,gBAAgB,mBACrB,MAAc,EACd,YAAqB;IAErB,MAAM,WAAW;QAAC;YAAE,MAAM;YAAQ,SAAS;QAAO;KAAE;IAEpD,MAAM,OAAY;QAChB,mBAAmB;QACnB,YAAY;QACZ;QACA,aAAa;IACf;IAEA,IAAI,cAAc;QAChB,KAAK,MAAM,GAAG;IAChB;IAEA,MAAM,UAAU,IAAI,+SAAoC,CAAC;QACvD,SAAS;QACT,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC;IAEnC,IAAI,SAAS,IAAI,EAAE;QACjB,WAAW,MAAM,SAAS,SAAS,IAAI,CAAE;YACvC,IAAI,MAAM,KAAK,EAAE,OAAO;gBACtB,MAAM,QAAQ,KAAK,KAAK,CAAC,IAAI,cAAc,MAAM,CAAC,MAAM,KAAK,CAAC,KAAK;gBACnE,IAAI,MAAM,IAAI,KAAK,uBAAuB;oBACxC,IAAI,MAAM,KAAK,EAAE,MAAM;wBACrB,MAAM,MAAM,KAAK,CAAC,IAAI;oBACxB;gBACF;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///home/ec2-user/project/path/path-web/app/api/bedrock/spec/route.ts"],"sourcesContent":["import { invokeClaudeStream } from \"@/lib/aws/bedrock\";\nimport { NextRequest } from \"next/server\";\n\nexport const maxDuration = 60;\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { analysis } = await req.json();\n\n    const systemPrompt = `당신은 20년차 소프트웨어 아키텍트이자 AI Agent 전문가 그리고 P.A.T.H (Problem-Agent-Technical-Handoff) 프레임워크를 개발한 전문가입니다.`;\n\n    const prompt = `다음 분석 결과를 바탕으로 프로토타입 구현을 위한 명세서를 작성하세요:\n\n${JSON.stringify(analysis, null, 2)}\n\n다음 5개 섹션만 작성하세요:\n\n# AI Agent Design Specification\n\n## 1. Executive Summary\n- **Problem**: 해결하려는 문제 (1-2문장)\n- **Solution**: 선택된 패턴과 접근 방법\n- **Feasibility Score**: X/50 (판정)\n- **Go/No-Go**: 추천 사항\n\n## 2. Problem Decomposition\n### INPUT\n- 트리거 타입과 상세 설명\n- 데이터 소스\n\n### PROCESS\n- 각 단계별 상세 설명 (번호 매겨서)\n\n### OUTPUT\n- 결과물 타입과 형식\n- 전달 방법\n\n### Human-in-Loop\n- 사람 개입 시점과 방법\n\n## 3. Architecture\n\n### 3.1 System Architecture\n\\`\\`\\`mermaid\ngraph TB\n    [전체 시스템 구조]\n\\`\\`\\`\n\n### 3.2 Sequence Diagram\n\\`\\`\\`mermaid\nsequenceDiagram\n    [컴포넌트 간 상호작용]\n\\`\\`\\`\n\n### 3.3 Flow Chart\n\\`\\`\\`mermaid\nflowchart TD\n    [처리 흐름]\n\\`\\`\\`\n\n## 4. Agent Components\n\n선택된 패턴에 맞게 작성하세요:\n\n| Agent Name | Role | Input | Output | LLM | Tools |\n|------------|------|-------|--------|-----|-------|\n\n## 5. Technical Stack\n- **Framework**:\n    - 이유: \n- **LLM**: \n    - 용도: \n    - 이유: \n\n---\n\n**중요1**: 위 5개 섹션만 작성하세요.\n**중요2**: LLM은 Claude Opus 4.5, Sonnet 4.5, Haiku 4.5 중에서만 선택하세요.\n**중요3**: Framework는 Strands SDK를 사용하세요.`;\n\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      async start(controller) {\n        try {\n          for await (const chunk of invokeClaudeStream(prompt, systemPrompt)) {\n            controller.enqueue(encoder.encode(`data: ${JSON.stringify({ text: chunk })}\\n\\n`));\n          }\n          controller.enqueue(encoder.encode(\"data: [DONE]\\n\\n\"));\n          controller.close();\n        } catch (error) {\n          console.error(\"Error in spec stream:\", error);\n          controller.error(error);\n        }\n      },\n    });\n\n    return new Response(stream, {\n      headers: {\n        \"Content-Type\": \"text/event-stream\",\n        \"Cache-Control\": \"no-cache\",\n        Connection: \"keep-alive\",\n      },\n    });\n  } catch (error: any) {\n    console.error(\"Error in spec API:\", error);\n    return new Response(\n      JSON.stringify({ \n        error: \"명세서 생성 중 오류가 발생했습니다\",\n        details: error.message \n      }),\n      {\n        status: 500,\n        headers: { \"Content-Type\": \"application/json\" },\n      }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGO,MAAM,cAAc;AAEpB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnC,MAAM,eAAe,CAAC,mGAAmG,CAAC;QAE1H,MAAM,SAAS,CAAC;;AAEpB,EAAE,KAAK,SAAS,CAAC,UAAU,MAAM,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uCAiEG,CAAC;QAEpC,MAAM,UAAU,IAAI;QACpB,MAAM,SAAS,IAAI,eAAe;YAChC,MAAM,OAAM,UAAU;gBACpB,IAAI;oBACF,WAAW,MAAM,SAAS,IAAA,oKAAkB,EAAC,QAAQ,cAAe;wBAClE,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;4BAAE,MAAM;wBAAM,GAAG,IAAI,CAAC;oBAClF;oBACA,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;oBAClC,WAAW,KAAK;gBAClB,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,yBAAyB;oBACvC,WAAW,KAAK,CAAC;gBACnB;YACF;QACF;QAEA,OAAO,IAAI,SAAS,QAAQ;YAC1B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,YAAY;YACd;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,MAAM,OAAO;QACxB,IACA;YACE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IAEJ;AACF"}}]
}