# Reflection Pattern (자기 성찰)

## 개념

Reflection 패턴은 Agent가 자신의 출력을 스스로 검토하고 개선하는 방식입니다.

```
Generate -> Critique -> Revise -> (반복) -> Final Output
```

## 핵심 구성 요소

### 1. Generator (생성자)
- 초기 출력 생성
- 이전 피드백 반영한 수정본 생성

### 2. Critic (평가자)
- 출력 품질 평가
- 구체적인 개선점 제시
- 완료 조건 판단

### 3. Revision Loop (수정 루프)
- 평가 결과에 따른 재생성
- 반복 횟수 제한 필요

## 적합한 상황

| 상황 | 설명 |
|------|------|
| 고품질 콘텐츠 | 보고서, 기사, 문서 작성 |
| 코드 생성 | 버그 없는 코드 작성 |
| 창작 작업 | 스토리, 카피라이팅 |

## Agent 구성 예시

### 단일 Agent Reflection

```
Reflection Agent
├── Generator Prompt
│   └── 콘텐츠 생성 지침
├── Critic Prompt
│   └── 품질 평가 기준
└── Loop Controller
    ├── 최대 반복: 3회
    └── 종료 조건: 품질 점수 >= 8/10
```

### 분리된 Agent Reflection

```
Generator Agent <-> Critic Agent
     |                    |
     v                    v
  초기 생성      품질 평가 + 피드백
     |                    |
     +-----> 수정본 <-----+
```

## State 관리

| State 유형 | 내용 | 예시 |
|-----------|------|------|
| **Current Draft** | 현재 버전 | 작성 중인 문서 |
| **Feedback History** | 피드백 기록 | 이전 평가 결과들 |
| **Quality Score** | 품질 점수 | 8/10 |
| **Iteration Count** | 반복 횟수 | 2/3 |

## 예제: 문서 작성 Agent

### Generator System Prompt

```
당신은 전문 문서 작성자입니다.

주어진 주제에 대해 명확하고 구조화된 문서를 작성하세요.

피드백이 제공되면:
1. 피드백을 주의 깊게 검토하세요
2. 지적된 문제점을 수정하세요
3. 개선된 버전을 작성하세요
```

### Critic System Prompt

```
당신은 편집자이자 품질 평가자입니다.

다음 기준으로 문서를 평가하세요:
- 명확성 (1-10): 내용이 이해하기 쉬운가?
- 구조 (1-10): 논리적으로 구성되었는가?
- 완성도 (1-10): 누락된 내용이 없는가?

총점 8점 이상이면 "APPROVED"
그 미만이면 구체적인 개선점을 제시하세요.
```

### 실행 흐름 예시

```
[Generate] 초기 보고서 작성

[Critique]
  - 명확성: 7/10 (기술 용어 설명 부족)
  - 구조: 8/10
  - 완성도: 6/10 (결론 미흡)
  - 총점: 7/10 -> 개선 필요

[Revise] 피드백 반영하여 수정

[Critique]
  - 명확성: 9/10
  - 구조: 8/10
  - 완성도: 8/10
  - 총점: 8.3/10 -> APPROVED

[Final Output] 최종 보고서 출력
```

## 주의사항

1. **무한 루프 방지**: 최대 반복 횟수 설정 (권장: 3-5회)
2. **명확한 평가 기준**: 객관적인 품질 지표 정의
3. **구체적인 피드백**: 추상적 비판보다 실행 가능한 제안
4. **비용 고려**: 반복마다 LLM 호출 비용 발생
